@startuml
!theme plain
skinparam backgroundColor #f8f9fa
skinparam defaultFontSize 11
skinparam component {
  BackgroundColor white
  BorderColor #333333
  FontColor #000000
}
skinparam ArrowColor #555555
skinparam ArrowFontColor #555555

title **DMS-K8S Microservices Architecture**\nKubernetes Deployment with Helm

actor "External Users" as Users
actor "Developers" as Devs

node "Frontend\n(React + Vite)\nPort: 5173" as Frontend #lightgreen
note right of Frontend
  User interface for
  device management
  and monitoring
end note

node "API Gateway\n(JWT Verifier)\nPort: 5003" as Gateway #lightcoral
note right of Gateway
  Validates JWT tokens
  Routes authenticated
  requests to services
end note

node "Auth Service\n(Flask + PostgreSQL)\nPort: 5000" as Auth #lightsalmon
note right of Auth
  User registration
  Login & JWT generation
  Token validation
end note

node "User Service\n(Flask + PostgreSQL)\nPort: 5002" as User #lightsteelblue
note right of User
  CRUD operations
  for user entities
  Role management
end note

node "Device Service\n(Flask + PostgreSQL)\nPort: 5001" as Device #plum
note right of Device
  Device lifecycle
  management
  User-device mapping
end note

node "Monitoring Service\n(Flask + PostgreSQL)\nPort: 5001" as Monitoring #lightblue
note right of Monitoring
  Consumption data storage
  Real-time device tracking
  Query API by user/date
end note

node "Message Service\n(Flask + WebSocket)\nPort: 5005" as MessageSvc #lightcyan
note right of MessageSvc
  Real-time chat support
  Rule-based & AI responses
  System notifications
end note

node "Device Simulator\n(Python)\nPort: 5001" as Simulator #lightyellow
note right of Simulator
  Generates realistic
  consumption data based
  on time and max capacity
end note

node "Load Balancer\n(Flask + RabbitMQ)\nPort: 5001" as LoadBalancer #orange
note right of LoadBalancer
  Distributes consumption
  data to monitoring
  service replicas
end note

queue "RabbitMQ\n(User Events)\nPort: 5672" as RabbitMQ1 #wheat
note bottom of RabbitMQ1
  Event bus for user
  and device CRUD events
end note

queue "RabbitMQ Collection\n(Consumption Data)\nPort: 5672" as RabbitMQ2 #wheat
note bottom of RabbitMQ2
  Consumption readings
  message broker
end note

node "Swagger Docs\n(OpenAPI UI)\nPort: 5015" as Swagger #lightyellow
note left of Swagger
  Interactive API
  documentation
  Testing interface
end note

Users -(0)- Frontend
Frontend -(0)- Gateway
Gateway -(0)- Auth
Gateway -(0)- User
Gateway -(0)- Device
Gateway -(0)- Monitoring
Gateway -(0)- MessageSvc

Auth -(0)- RabbitMQ1 : publish/consume
User -(0)- RabbitMQ1 : publish/consume
Device -(0)- RabbitMQ1 : publish/consume
Monitoring -(0)- RabbitMQ1 : consume

MessageSvc -(0)- User : admin lookup
MessageSvc -(0)- Monitoring : alerts

Simulator -(0)- Device : fetch
Simulator -(0)- RabbitMQ2 : publish
LoadBalancer -(0)- RabbitMQ2 : consume
LoadBalancer -(0)- Monitoring : forward

Devs -(0)- Swagger

@enduml
